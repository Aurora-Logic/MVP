<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProposalKit — Professional Proposals in Minutes</title>
    <meta name="description" content="Build professional proposals in minutes. Export polished PDFs.">
    <meta name="theme-color" content="#18181b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.svg">
    <!-- Inter Font (replacing DM Sans) + JetBrains Mono -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Tailwind CSS v4 Browser CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <!-- Inline theme detection (prevent FOUC) -->
    <script>
        (function () {
            const theme = localStorage.getItem('pk_theme') ||
                (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.classList.toggle('dark', theme === 'dark');
        })();
    </script>
    <!-- App CSS (modular) -->
    <link rel="stylesheet" href="assets/css/variables.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/layout.css">
    <link rel="stylesheet" href="assets/css/pages.css">
    <link rel="stylesheet" href="assets/css/features.css">
    <link rel="stylesheet" href="assets/css/pdf.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <link rel="stylesheet" href="assets/css/print.css">

</head>

<body>

    <!-- ═══ ONBOARDING ═══ -->
    <div class="onboard" id="onboard">
        <div class="ob-card ob-card-wide">
            <div class="ob-icon">P</div>
            <div id="obContent"></div>
        </div>
    </div>

    <!-- ═══ APP ═══ -->
    <div class="app" id="appShell" style="display:none">
        <!-- Mobile sidebar overlay -->
        <div class="side-overlay" id="sideOverlay" onclick="closeMobileSidebar()"></div>

        <!-- Sidebar -->
        <aside class="side" id="sidebar" role="navigation" aria-label="Main navigation">
            <button class="side-collapse-btn" onclick="toggleSidebar()" title="Collapse sidebar">
                <i data-lucide="chevron-left"></i>
            </button>
            <div class="side-top">
                <div class="side-logo" id="sideLogo">P</div>
                <div class="side-top-info">
                    <span class="side-brand">ProposalKit</span>
                    <!-- <span class="side-tag">Beta</span> -->
                </div>
                <button class="side-new-btn" onclick="openNewModal()" data-tooltip="New Proposal" data-side="bottom">
                    <i data-lucide="plus"></i>
                </button>
            </div>
            <div class="side-body">
                <button class="side-btn on" data-nav="dashboard" onclick="goNav('dashboard')"><i
                        data-lucide="layout-dashboard"></i><span>Dashboard</span></button>
                <button class="side-btn" data-nav="editor" onclick="goNav('editor')"><i
                        data-lucide="file-text"></i><span>Proposals</span><span class="cnt"
                        id="propCnt">0</span></button>
                <button class="side-btn" data-nav="clients" onclick="goNav('clients')"><i
                        data-lucide="users"></i><span>Clients</span><span class="cnt" id="clientCnt">0</span></button>

                <div class="side-divider"></div>

                <div class="side-label">Recent</div>
                <div id="recentList"></div>
            </div>
            <div class="side-foot">
                <button class="side-foot-btn" data-nav="settings" onclick="goNav('settings')"><i
                        data-lucide="settings"></i><span>Settings</span></button>
                <button class="side-foot-btn" onclick="toggleTheme()" id="sideThemeBtn"><i data-lucide="sun"
                        class="theme-icon-light"></i><i data-lucide="moon"
                        class="theme-icon-dark"></i><span>Theme</span></button>
            </div>
        </aside>

        <!-- Main -->
        <div class="main">
            <div class="topbar">
                <button class="hamburger-btn" id="hamburgerBtn" onclick="toggleMobileSidebar()"
                    aria-label="Toggle menu">
                    <i data-lucide="menu"></i>
                </button>
                <span class="topbar-title" id="topTitle">Dashboard</span>
                <span class="save-indicator" id="saveIndicator" style="display:none" aria-live="polite" role="status">
                    <i data-lucide="loader-2" class="save-icon saving"></i>
                    <i data-lucide="check" class="save-icon saved"></i>
                    <span class="save-text">Saved</span>
                </span>
                <div class="topbar-search" id="topSearch">
                    <i data-lucide="search"></i>
                    <input type="text" placeholder="Search proposals..." id="searchInput" oninput="filterList()"
                        aria-label="Search proposals">
                    <kbd class="kbd" style="cursor:pointer" onclick="openCommandPalette()"
                        title="Open command palette">⌘K</kbd>
                </div>
                <div class="topbar-right" id="topRight"></div>
            </div>
            <div class="body-scroll" id="bodyScroll"></div>
        </div>
    </div>

    <!-- Preview -->
    <div class="overlay" id="ov" onclick="closePreview()"></div>
    <div class="preview" id="prevPanel">
        <div class="prev-top">
            <i data-lucide="eye" style="width:16px;height:16px;color:var(--text3)"></i>
            <span class="prev-top-t">Preview</span>
            <div class="tpl-picker" id="tplPicker">
                <button class="tpl-pick on" onclick="setDocTpl('modern',this)">Modern</button>
                <button class="tpl-pick" onclick="setDocTpl('clean',this)">Clean</button>
                <button class="tpl-pick" onclick="setDocTpl('minimal',this)">Minimal</button>
                <button class="tpl-pick" onclick="setDocTpl('executive',this)">Executive</button>
                <button class="tpl-pick" onclick="setDocTpl('stripe',this)">Stripe</button>
                <button class="tpl-pick" onclick="setDocTpl('nord',this)">Nord</button>
                <button class="tpl-pick" onclick="setDocTpl('bold',this)">Bold</button>
                <button class="tpl-pick" onclick="setDocTpl('compact',this)">Compact</button>
                <button class="tpl-pick" onclick="setDocTpl('sidebar',this)">Sidebar</button>
                <button class="tpl-pick" onclick="setDocTpl('formal',this)">Formal</button>
                <button class="tpl-pick" onclick="setDocTpl('american',this)">American</button>
                <button class="tpl-pick" onclick="setDocTpl('classic',this)">Classic</button>
                <button class="tpl-pick" onclick="setDocTpl('tabular',this)">Tabular</button>
            </div>
            <div style="display:flex;gap:6px">
                <button class="btn-sm-outline" onclick="doExport('invoice')"><i data-lucide="receipt"></i> As
                    Invoice</button>
                <button class="btn-sm" onclick="doExport('proposal')"><i data-lucide="download"></i> Export
                    PDF</button>
                <button class="btn-icon-outline" onclick="closePreview()" data-tooltip="Close" data-side="bottom"
                    data-align="center"><i data-lucide="x"></i></button>
            </div>
        </div>
        <div class="prev-body">
            <div class="prev-doc" id="prevDoc"></div>
        </div>
    </div>

    <!-- New Proposal Modal (content built dynamically by openNewModal) -->
    <div class="modal-wrap" id="newModal" onclick="closeNewModal(event)" role="dialog" aria-modal="true" aria-label="New Proposal">
        <div class="modal modal-lg" id="newModalInner" onclick="event.stopPropagation()"></div>
    </div>

    <!-- Context Menu -->
    <div class="ctx" id="ctxMenu" role="menu" aria-label="Proposal actions">
        <div class="ctx-item" role="menuitem" onclick="ctxAction('open')"><i data-lucide="external-link"></i> Open</div>
        <div class="ctx-item" role="menuitem" onclick="ctxAction('dup')"><i data-lucide="copy"></i> Duplicate</div>
        <div class="ctx-item" role="menuitem" onclick="ctxAction('dupClient')"><i data-lucide="users"></i> Duplicate for Client</div>
        <div class="ctx-item" role="menuitem" onclick="ctxAction('export')"><i data-lucide="download"></i> Export PDF</div>
        <div class="ctx-item" role="menuitem" onclick="ctxAction('invoice')"><i data-lucide="receipt"></i> Export as Invoice</div>
        <div class="ctx-sep" role="separator"></div>
        <div class="ctx-item" role="menuitem" id="ctxArchive" onclick="ctxAction('archive')"><i data-lucide="archive"></i> Archive</div>
        <div class="ctx-item" role="menuitem" id="ctxUnarchive" onclick="ctxAction('unarchive')" style="display:none"><i
                data-lucide="archive-restore"></i> Unarchive</div>
        <div class="ctx-item danger" role="menuitem" onclick="ctxAction('del')"><i data-lucide="trash-2"></i> Delete</div>
    </div>

    <!-- Toast -->
    <div class="toasts" id="toastBox" aria-live="assertive" role="alert"></div>

    <!-- Global Loading Indicator -->
    <div class="loading-overlay" id="loadingOverlay" style="display:none">
        <div class="loading-spinner">
            <i data-lucide="loader-2"></i>
            <span id="loadingText">Loading...</span>
        </div>
    </div>

    <!-- Core: Foundation (loaded first, no deps) -->
    <script src="assets/js/core/store.js"></script>
    <script src="assets/js/core/utils.js"></script>
    <script src="assets/js/core/custom-select.js"></script>
    <script src="assets/js/core/theme.js"></script>
    <script src="assets/js/core/variables.js"></script>
    <script src="assets/js/core/modals.js"></script>
    <script src="assets/js/core/autosave.js"></script>
    <script src="assets/js/core/command.js"></script>
    <script src="assets/js/core/shortcuts.js"></script>
    <script src="assets/js/core/completeness.js"></script>
    <script src="assets/js/core/onboarding.js"></script>
    <!-- CDN: Editor.js + plugins -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@2.29.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/header@2.8.7"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/list@1.9.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/quote@2.7.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/marker@1.4.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/delimiter@1.4.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/table@2.2.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/checklist@1.5.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/code@2.8.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/inline-code@1.4.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/underline@1.1.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/embed@2.5.3"></script>
    <!-- Editor: Editor tabs & components -->
    <script src="assets/js/editor/focus-mode.js"></script>
    <!-- Views: Main page views -->
    <script src="assets/js/views/nav.js"></script>
    <script src="assets/js/views/dashboard.js"></script>
    <script src="assets/js/views/proposals.js"></script>
    <script src="assets/js/views/kanban.js"></script>
    <script src="assets/js/views/analytics.js"></script>
    <script src="assets/js/views/analytics-breakdowns.js"></script>
    <!-- Editor: Main editor + all tabs -->
    <script src="assets/js/editor/toc.js"></script>
    <script src="assets/js/editor/editor.js"></script>
    <script src="assets/js/editor/details.js"></script>
    <script src="assets/js/editor/sections.js"></script>
    <script src="assets/js/editor/structured-sections.js"></script>
    <script src="assets/js/editor/section-packs.js"></script>
    <script src="assets/js/editor/pricing.js"></script>
    <script src="assets/js/editor/tc-library.js"></script>
    <script src="assets/js/editor/csv-import.js"></script>
    <script src="assets/js/editor/packages.js"></script>
    <script src="assets/js/editor/addons.js"></script>
    <script src="assets/js/editor/payment-schedule.js"></script>
    <script src="assets/js/editor/notes.js"></script>
    <!-- Export: PDF, preview, sharing -->
    <script src="assets/js/export/preview.js"></script>
    <script src="assets/js/export/templates.js"></script>
    <script src="assets/js/export/pdf-templates2.js"></script>
    <script src="assets/js/export/export.js"></script>
    <script src="assets/js/export/email.js"></script>
    <script src="assets/js/views/clients.js"></script>
    <script src="assets/js/export/signature.js"></script>
    <script src="assets/js/views/settings.js"></script>
    <script src="assets/js/export/tpl-data.js"></script>
    <script src="assets/js/export/sharing.js"></script>
    <script src="assets/js/export/create.js"></script>
    <!-- Boot: App initialization (always last) -->
    <script src="assets/js/boot.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => {});
        }
    </script>

</body>

</html>